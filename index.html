<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RNBO Test</title>
</head>

<body style="background:black; color:white; font-family:monospace;">
    <h1>RNBO Web Test</h1>
    <p>Click anywhere to start audio.</p>

    <script src="rnbo.min.js"></script>

    <script>
        let context;
        let device;

        async function setup() {
            // Create AudioContext
            context = new (window.AudioContext || window.webkitAudioContext)();

            console.log("AudioContext created:", context.state);

            // Load the RNBO patcher JSON
            const response = await fetch("organic_website_soundtrack.export.json");
            const patcher = await response.json();

            console.log("JSON loaded");

            // Create the RNBO device
            const factory = await RNBO.createDevice({ context, patcher });
            device = factory;

            console.log("RNBO started");
            console.log("Parameters:", Array.from(device.parameters));
            console.log("Device node:", device.node);

            // Connect to output
            device.node.connect(context.destination);
        }

        setup();

        // Resume audio on click
        document.addEventListener("click", async () => {
            if (context && context.state === "suspended") {
                await context.resume();
                console.log("AudioContext resumed:", context.state);
            }
        });
    </script>
</body>
</html>
